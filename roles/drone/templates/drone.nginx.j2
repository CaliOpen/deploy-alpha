http {
  
    upstream drone {
        server drone-server:8000;
    }

    server {
        listen 443 ssl;
        listen [::]:443 ssl:
        server_name drone.{{ caliopen_base_domain }};

        ssl_certificate     /etc/nginx/certs/{{ caliopen_base_domain }}.crt;
        ssl_certificate_key /etc/nginx/certs/{{ caliopen_base_domain }}.key;
        ssl_prefer_server_ciphers On;
        ssl_protocols TLSv1.1 TLSv1.2;
        ssl_ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS;
        ssl_session_cache shared:SSL:10m;

        location / {
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header Host $http_host;

            proxy_pass http://drone;
            proxy_redirect off;
            proxy_http_version 1.1;
            proxy_buffering off;

            chunked_transfer_encoding off;
        }
    }

}